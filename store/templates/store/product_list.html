{% extends 'base.html' %}
{% load static %}

{% block title %}Products - Storefront{% endblock %}

{% block content %}
<div class="container">
    <div class="hero">
        <h1>Our Products</h1>
        <p>Discover our amazing collection of products</p>
    </div>

    <!-- Filters and Search -->
    <div class="card filter-card">
        <form method="get" id="filter-form">
            <div class="filter-grid">
                <div class="form-group">
                    <label for="search">Search</label>
                    <input type="text" name="search" id="search" class="form-control" value="{{ request.GET.search }}" placeholder="Search products...">
                </div>
                <div class="form-group">
                    <label for="collection">Collection</label>
                    <select name="collection_id" id="collection" class="form-control">
                        <option value="">All Collections</option>
                        {% for collection in collections %}
                            <option value="{{ collection.id }}" {% if request.GET.collection_id == collection.id|stringformat:"s" %}selected{% endif %}>
                                {{ collection.title }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="ordering">Sort By</label>
                    <select name="ordering" id="ordering" class="form-control">
                        <option value="">Default</option>
                        <option value="unit_price" {% if request.GET.ordering == "unit_price" %}selected{% endif %}>Price: Low to High</option>
                        <option value="-unit_price" {% if request.GET.ordering == "-unit_price" %}selected{% endif %}>Price: High to Low</option>
                        <option value="title" {% if request.GET.ordering == "title" %}selected{% endif %}>Name: A-Z</option>
                        <option value="-title" {% if request.GET.ordering == "-title" %}selected{% endif %}>Name: Z-A</option>
                    </select>
                </div>
                <div class="form-group d-flex align-center">
                    <button type="submit" class="btn btn-primary w-100">Apply Filters</button>
                </div>
            </div>
        </form>
    </div>

    <!-- Products Grid -->
    <div class="card-grid">
        {% for product in products %}
            <div class="product-card">
                {% if product.images.first %}
                    <img src="{{ product.images.first.image.url }}" alt="{{ product.title }}" class="product-image">
                {% else %}
                    <div class="product-image no-image-placeholder">
                        <span class="text-muted">No Image</span>
                    </div>
                {% endif %}
                <div class="product-body">
                    <h3 class="product-title">{{ product.title }}</h3>
                    <p class="product-description">{{ product.description|truncatewords:15 }}</p>
                    <div class="product-price">${{ product.unit_price }}</div>
                    <div class="mb-2 text-light text-sm">
                        {% if product.inventory > 10 %}
                            <span class="stock-in">✓ In Stock</span>
                        {% elif product.inventory > 0 %}
                            <span class="stock-low">⚠ Only {{ product.inventory }} left</span>
                        {% else %}
                            <span class="stock-out">✗ Out of Stock</span>
                        {% endif %}
                    </div>
                    <div class="product-footer">
                        <a href="{% url 'store:product-detail' product.id %}" class="btn btn-outline flex-1 text-center">View Details</a>
                        {% if product.inventory > 0 %}
                            <button onclick="addToCart({{ product.id }})" class="btn btn-primary">Add to Cart</button>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="card grid-col-full empty-state">
                <h3>No products found</h3>
                <p>Try adjusting your filters</p>
            </div>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.collection_id %}&collection_id={{ request.GET.collection_id }}{% endif %}{% if request.GET.ordering %}&ordering={{ request.GET.ordering }}{% endif %}">&laquo; First</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.collection_id %}&collection_id={{ request.GET.collection_id }}{% endif %}{% if request.GET.ordering %}&ordering={{ request.GET.ordering }}{% endif %}">Previous</a>
            {% endif %}

            <span class="active">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.collection_id %}&collection_id={{ request.GET.collection_id }}{% endif %}{% if request.GET.ordering %}&ordering={{ request.GET.ordering }}{% endif %}">Next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.collection_id %}&collection_id={{ request.GET.collection_id }}{% endif %}{% if request.GET.ordering %}&ordering={{ request.GET.ordering }}{% endif %}">Last &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endblock %}
